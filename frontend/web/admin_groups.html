<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin — Groupes</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container layout">
    <aside class="sidebar">
      <h2 class="brand">DONS Admin</h2>
      <nav>
        <a href="dashboard.html">Tableau de bord</a>
        <a class="active" href="admin_groups.html">Groupes</a>
        <a href="admin_members.html">Membres</a>
        <a href="admin_exports.html">Exports</a>
        <a href="admin_payments.html">Paiements</a>
      </nav>
    </aside>
    <div class="content card">
      <div class="header">
        <h1 class="title">Groupes</h1>
      </div>
      <div class="grid">
        <form id="create" class="grid grid-2">
          <div>
            <label for="name">Nom du groupe</label>
            <input id="name" required>
          </div>
          <div>
            <label for="description">Description</label>
            <input id="description">
          </div>
          <div class="row" style="grid-column:1 / -1">
            <button type="submit">Créer le groupe</button>
            <span id="msg" class="muted"></span>
          </div>
        </form>
        <table class="table" id="table">
          <thead><tr><th>ID</th><th>Nom</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="error" class="muted" style="color:#ef4444"></div>
      </div>
    </div>
  </div>
  <script src="api.js"></script>
  <script>
    const tbody = document.querySelector('#table tbody');
    const errorEl = document.getElementById('error');
    const msg = document.getElementById('msg');
    async function load(){
      errorEl.textContent=''; tbody.innerHTML='';
      try{
        const res = await DonsApi.AdminApi.getGroups();
        (res?.data || res || []).forEach(g=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${g.id||''}</td><td>${g.name||g.nom||''}</td><td><button data-id="${g.id}">Supprimer</button></td>`;
          tbody.appendChild(tr);
        });
      }catch(e){ errorEl.textContent = e?.data?.message || e.message; }
    }
    document.getElementById('create').addEventListener('submit', async(e)=>{
      e.preventDefault(); msg.textContent='';
      try{
        await DonsApi.AdminApi.createGroup({ name: document.getElementById('name').value, description: document.getElementById('description').value });
        msg.textContent='Créé.'; await load();
      }catch(e){ msg.textContent = e?.data?.message || e.message; }
    });
    tbody.addEventListener('click', async(e)=>{
      const id = e.target?.dataset?.id; if(!id) return;
      try{ await DonsApi.AdminApi.deleteGroup(id); await load(); }catch(err){ alert(err?.data?.message||err.message); }
    });
    load();
  </script>
</body>
</html>


