<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inscription — DONS Admin</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="card" style="max-width:720px;margin:0 auto;">
      <div class="header">
        <h1 class="title">Créer un compte administrateur</h1>
      </div>
      <p class="muted">Renseignez vos informations pour accéder au tableau de bord.</p>

      <form id="signup-form" class="grid grid-2" style="margin-top:10px">
        <div>
          <label for="first_name">Prénom</label>
          <input id="first_name" name="first_name" required>
        </div>
        <div>
          <label for="last_name">Nom</label>
          <input id="last_name" name="last_name" required>
        </div>
        <div>
          <label for="phone_number">Numéro de téléphone</label>
          <input id="phone_number" name="phone_number" autocomplete="tel" required>
        </div>
        <div>
          <label for="email">Email (optionnel)</label>
          <input id="email" name="email" type="email" autocomplete="email">
        </div>
        <div>
          <label for="password">Mot de passe</label>
          <input id="password" name="password" type="password" required>
        </div>
        <div>
          <label for="password_confirmation">Confirmer le mot de passe</label>
          <input id="password_confirmation" name="password_confirmation" type="password" required>
        </div>
        <div class="row" style="grid-column:1 / -1;">
          <button type="submit" id="submit">Créer le compte</button>
          <a class="link right" href="login.html">J'ai déjà un compte</a>
        </div>
        <div id="error" class="muted" style="color:#fecaca;grid-column:1 / -1;"></div>
        <div id="success" class="muted" style="color:#86efac;grid-column:1 / -1;"></div>
      </form>
      <div class="footer">Un OTP sera envoyé pour vérification (mode test activé).</div>
    </div>
  </div>

  <script src="api.js"></script>
  <script>
    const form = document.getElementById('signup-form');
    const errorBox = document.getElementById('error');
    const okBox = document.getElementById('success');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorBox.textContent = ''; okBox.textContent = '';
      const payload = {
        first_name: document.getElementById('first_name').value.trim(),
        last_name: document.getElementById('last_name').value.trim(),
        phone_number: document.getElementById('phone_number').value.trim(),
        email: document.getElementById('email').value.trim() || null,
        password: document.getElementById('password').value,
        password_confirmation: document.getElementById('password_confirmation').value,
      };
      const btn = document.getElementById('submit');
      btn.disabled = true; btn.textContent = 'Création...';
      try {
        const res = await DonsApi.AuthApi.register(payload);
        okBox.textContent = res?.message || 'Compte créé.';
        if (res?.token) {
          DonsApi.setAuthToken(res.token);
          location.href = 'dashboard.html';
        } else {
          setTimeout(()=>{ location.href = 'login.html'; }, 800);
        }
      } catch (err) {
        const errs = err?.data?.errors;
        if (errs) {
          const parts = [];
          Object.keys(errs).forEach(k => { parts.push(`${k}: ${errs[k].join ? errs[k].join(', ') : errs[k]}`); });
          errorBox.textContent = parts.join(' | ');
        } else {
          errorBox.textContent = err?.data?.message || err.message || 'Erreur d\'inscription';
        }
      } finally {
        btn.disabled = false; btn.textContent = 'Créer le compte';
      }
    });
  </script>
</body>
</html>



